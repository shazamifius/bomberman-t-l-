<!DOCTYPE html>
<html>
<head>
    <title>Bomberman Controller</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/style.css">
</head>
<body class="controller-body">
    <div id="join-screen">
        <h1>Bomberman</h1>
        <input type="text" id="nickname" placeholder="Enter Nickname" maxlength="10">
        <button id="join-btn">Join Game</button>
    </div>

    <div id="game-controls" style="display: none;">
        <div class="d-pad">
            <button class="control-btn" id="up">‚¨ÜÔ∏è</button>
            <button class="control-btn" id="left">‚¨ÖÔ∏è</button>
            <button class="control-btn" id="right">‚û°Ô∏è</button>
            <button class="control-btn" id="down">‚¨áÔ∏è</button>
        </div>
        <div class="action-pad">
            <button class="bomb-btn" id="bomb">üí£</button>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const joinScreen = document.getElementById('join-screen');
        const gameControls = document.getElementById('game-controls');
        const joinBtn = document.getElementById('join-btn');
        const nicknameInput = document.getElementById('nickname');

        joinBtn.addEventListener('click', () => {
            const nickname = nicknameInput.value.trim();
            socket.emit('joinGame', nickname);
            joinScreen.style.display = 'none';
            gameControls.style.display = 'flex';
        });

        const buttons = {
            up: document.getElementById('up'),
            down: document.getElementById('down'),
            left: document.getElementById('left'),
            right: document.getElementById('right'),
            bomb: document.getElementById('bomb'),
        };

        let movementInterval = null;

        function handleMove(direction) {
            clearInterval(movementInterval);
            movementInterval = setInterval(() => {
                socket.emit('move', direction);
            }, 50); // Send move event every 50ms while held
             if (navigator.vibrate) navigator.vibrate(50);
        }

        function stopMove() {
            clearInterval(movementInterval);
        }

        buttons.up.addEventListener('touchstart', () => handleMove('up'));
        buttons.down.addEventListener('touchstart', () => handleMove('down'));
        buttons.left.addEventListener('touchstart', () => handleMove('left'));
        buttons.right.addEventListener('touchstart', () => handleMove('right'));

        buttons.up.addEventListener('touchend', stopMove);
        buttons.down.addEventListener('touchend', stopMove);
        buttons.left.addEventListener('touchend', stopMove);
        buttons.right.addEventListener('touchend', stopMove);

        buttons.bomb.addEventListener('click', () => {
            socket.emit('placeBomb');
            if (navigator.vibrate) navigator.vibrate(100);
        });

        socket.on('gameFull', () => {
            alert("Sorry, the game is full!");
            joinScreen.style.display = 'flex';
            gameControls.style.display = 'none';
        });

        socket.on('disconnect', () => {
            alert("Disconnected from server.");
            joinScreen.style.display = 'flex';
            gameControls.style.display = 'none';
        });

        socket.on('gameRestart', () => {
            // Can optionally go back to the join screen, but for now, we'll let them stay connected
            console.log("A new round is starting!");
        });
    </script>
</body>
</html>
