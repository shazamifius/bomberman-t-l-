<!DOCTYPE html>
<html>
<head>
    <title>Bomberman Controller</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/style.css">
</head>
<body class="controller-body">
    <div id="join-screen">
        <h1>Bomberman</h1>
        <input type="text" id="nickname" placeholder="Enter Nickname" maxlength="10">
        <button id="join-btn">Join Game</button>
    </div>

    <div id="game-controls" style="display: none;">
        <div class="d-pad">
            <button class="control-btn" data-direction="up">‚¨ÜÔ∏è</button>
            <button class="control-btn" data-direction="left">‚¨ÖÔ∏è</button>
            <button class="control-btn" data-direction="right">‚û°Ô∏è</button>
            <button class="control-btn" data-direction="down">‚¨áÔ∏è</button>
        </div>
        <div class="action-pad">
            <button class="bomb-btn" id="bomb-btn">üí£</button>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const joinScreen = document.getElementById('join-screen');
        const gameControls = document.getElementById('game-controls');
        const joinBtn = document.getElementById('join-btn');
        const nicknameInput = document.getElementById('nickname');
        const dpadButtons = document.querySelectorAll('.control-btn');
        const bombBtn = document.getElementById('bomb-btn');

        let lastMoveTime = 0;
        const MOVE_COOLDOWN = 200; // 200ms

        joinBtn.addEventListener('click', () => {
            const nickname = nicknameInput.value.trim();
            socket.emit('joinGame', nickname);
            joinScreen.style.display = 'none';
            gameControls.style.display = 'flex';
        });

        dpadButtons.forEach(button => {
            button.addEventListener('click', () => {
                const now = Date.now();
                if (now - lastMoveTime > MOVE_COOLDOWN) {
                    const direction = button.dataset.direction;
                    socket.emit('move', direction);
                    lastMoveTime = now;
                    if (navigator.vibrate) navigator.vibrate(50);
                }
            });
        });

        bombBtn.addEventListener('click', () => {
            socket.emit('bomb');
            if (navigator.vibrate) navigator.vibrate(100);
        });

        socket.on('gameFull', () => {
            alert("Sorry, the game is full!");
            joinScreen.style.display = 'flex';
            gameControls.style.display = 'none';
        });

        socket.on('disconnect', () => {
            alert("Disconnected from server.");
            joinScreen.style.display = 'flex';
            gameControls.style.display = 'none';
        });
    </script>
</body>
</html>
